#:kivy 2.2.1
#:set OFFSET 10
#:set WIDTH_HINT_TOP 0.75
#:set CHARACTER_HEIGHT_HINT 0.3

<DialogLayout>:

    canvas.before:
        Color:
            rgba: self.background_color
        # Top rectangle
        Rectangle:
            pos: 0, (1-CHARACTER_HEIGHT_HINT)*self.height - 2*OFFSET*self.font_ratio
            size: WIDTH_HINT_TOP*self.width, (CHARACTER_HEIGHT_HINT)*self.height + 2*OFFSET*self.font_ratio
        # Image rectangle
        Rectangle:
            pos: OFFSET*self.font_ratio, (1-CHARACTER_HEIGHT_HINT)*self.height-OFFSET*self.font_ratio
            size: CHARACTER_HEIGHT_HINT*self.height, CHARACTER_HEIGHT_HINT*self.height
        # Bottom rectangle
        Rectangle:
            pos: 0, 0
            size: self.width, (1-CHARACTER_HEIGHT_HINT)*self.height - 3*OFFSET*self.font_ratio

    canvas.after:
        # Frame around the image
        Color:
            rgba: self.frame_color
        Line:
            rectangle: self.x+OFFSET*self.font_ratio, self.y+(1-CHARACTER_HEIGHT_HINT)*self.height-OFFSET*self.font_ratio, CHARACTER_HEIGHT_HINT*self.height, CHARACTER_HEIGHT_HINT*self.height
            width: self.frame_width*self.font_ratio

    # Image of the character
    Image:
        id: image
        source: root.character_image
        x: OFFSET*root.font_ratio
        y: (1-CHARACTER_HEIGHT_HINT)*root.height - OFFSET*root.font_ratio
        size_hint: (None, CHARACTER_HEIGHT_HINT)
        width: self.height
    
    # Name of the character
    Label:
        text: root.character_name
        y: (1-CHARACTER_HEIGHT_HINT/2)*root.height
        x: 2*OFFSET*root.font_ratio + image.width
        size_hint: (None, None)
        width: WIDTH_HINT_TOP*root.width - self.x - OFFSET*root.font_ratio
        height: CHARACTER_HEIGHT_HINT/2*root.height - 3*OFFSET*root.font_ratio
        font_name: root.font_name_title
        font_size: root.font_ratio*root.font_size_title
        color: root.font_color
        text_size: self.size
        halign: "left"
        valign: "middle"

    # Title of the character
    Label:
        text: root.character_title
        x: 2*OFFSET*root.font_ratio + image.width
        y: (1-CHARACTER_HEIGHT_HINT)*root.height
        size_hint: (None, None)
        width: WIDTH_HINT_TOP*root.width - self.x - OFFSET*root.font_ratio
        height: CHARACTER_HEIGHT_HINT/2*root.height
        font_name: root.font_name_title
        font_size: root.font_ratio*root.font_size_text
        color: root.font_color
        text_size: self.size
        halign: "left"
        valign: "middle"

    # Dialog content
    Label:
        text: root.text
        x: OFFSET*root.font_ratio
        y: OFFSET*root.font_ratio
        size_hint: (None, None)
        width: root.width - 2*OFFSET*root.font_ratio
        height: (1-CHARACTER_HEIGHT_HINT)*root.height - 5*OFFSET*root.font_ratio
        font_name: root.font_name_text
        font_size: root.font_ratio*root.font_size_text
        color: root.font_color
        text_size: self.size
        halign: "left"
        valign: "top"
        markup: True
