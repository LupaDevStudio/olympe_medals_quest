#:kivy 2.2.1
#:set CHARACTER_LINE_OFFSET_HORIZONTAL 10

<CharacterWithNameLayout>:

    # Background
    canvas.before:
        Color:
            rgba: self.background_color
        Rectangle:
            pos: (0, 0)
            size: self.size
        Color:
            rgba: self.line_color
        Line:
            points: [CHARACTER_LINE_OFFSET_HORIZONTAL*self.font_ratio, self.height*0.8, self.width-CHARACTER_LINE_OFFSET_HORIZONTAL*self.font_ratio, self.height*0.8]
            width: self.line_width*root.font_ratio

    Label:
        text: root.character_name
        font_size: root.font_ratio * root.font_size
        font_name: root.text_font_name
        x: CHARACTER_LINE_OFFSET_HORIZONTAL*root.font_ratio
        y: root.height*0.9 - self.height//2
        shorten: False
        size_hint: (None, None)
        size: self.texture_size
        halign: "left"
        valign: "middle"
        color: root.font_color

    CharacterButtonWithIcon:
        image_source: root.image_source
        icon_source: PATH_ICONS + "hurt.png"
        icon_mode: root.is_hurt
        icon_position: {"right": 0.95, "y": 0.05}
        size_hint: (None, 0.6)
        width: self.height
        pos_hint: {"center_x": 0.5, "y": 0.075}
        font_ratio: root.font_ratio
        release_function: root.release_function
        line_width: root.line_width


    
<CharacterWithMainInfoFireLayout>:

    # Background
    OlympeCard:
        pos: (0, 0)
        size_hint: (CARD_WIDTH, 1)
        font_ratio: root.font_ratio

    CharacterButtonWithIcon:
        id: character
        image_source: root.image_source
        icon_source: PATH_ICONS + "hurt.png"
        icon_mode: root.is_hurt
        icon_position: {"right": 0.95, "y": 0.05}
        size_hint: (None, 0.5)
        width: self.height
        pos_hint: {"x": 0.05, "y": 0.4}
        font_ratio: root.font_ratio
        line_width: root.line_width
        disable_button: True

    PressedButton:
        text: root.fire_text
        size_hint: (None, 0.2)
        width: character.width
        pos_hint: {"x": 0.05, "y": 0.1}
        font_ratio: root.font_ratio
        pressed_color: COLORS.red_pressed
        background_color: COLORS.red
        release_function: root.fire_athlete_function

    ### Information ###
    
    MoneyLayout:
        coins_count: root.salary
        salary_mode: True
        font_ratio: root.font_ratio
        size_hint: (None, 0.14)
        width: root.width * (1 - 0.05*4) - character.width
        pos_hint: {"y": 0.05*5 + 4*0.14}
        x: root.width * 0.05 * 2 + character.width

    SurroundedLabel:
        text: root.age
        font_ratio: root.font_ratio
        size_hint: (None, 0.14)
        width: root.width * (1 - 0.05*4) - character.width
        pos_hint: {"y": 0.05*4 + 3*0.14}
        x: root.width * 0.05 * 2 + character.width

    SurroundedLabel:
        text: root.reputation
        font_ratio: root.font_ratio
        size_hint: (None, 0.14)
        width: root.width * (1 - 0.05*4) - character.width
        pos_hint: {"y": 0.05*3 + 2*0.14}
        x: root.width * 0.05 * 2 + character.width

    SurroundedLabel:
        text: root.fatigue
        font_ratio: root.font_ratio
        size_hint: (None, 0.14)
        width: root.width * (1 - 0.05*4) - character.width
        pos_hint: {"y": 0.05*2 + 0.14}
        x: root.width * 0.05 * 2 + character.width

    SurroundedLabel:
        text: root.health
        font_ratio: root.font_ratio
        size_hint: (None, 0.14)
        width: root.width * (1 - 0.05*4) - character.width
        pos_hint: {"y": 0.05}
        x: root.width * 0.05 * 2 + character.width

<StatBar>:

    canvas.after:
        Color:
            rgba: root.color
        RoundedRectangle:
            size: (self.width*0.25,self.height*0.9)
            pos: (self.x,self.y+self.height*0.05)
            radius: [self.radius*self.font_ratio]

<CharacterStats>:

    height: self.width / 7.9 # Set the ratio of the bar

    # Learning flame 1
    Image:
        id: learning_flame_1
        source: PATH_ICONS + "flame.png"
        pos_hint: {"x":0,"center_y":0.5}
        size_hint: (0.09, 1)
        fit_mode: "contain"
        opacity: 1 if root.learning_rate == 2 else 0
    
    # Learning flame 2
    Image:
        id: learning_flame_2
        source: PATH_ICONS + "flame.png"
        pos_hint: {"x":0.09,"center_y":0.5}
        size_hint: (0.09, 1)
        fit_mode: "contain"
        opacity: 1 if root.learning_rate >= 1.5 else 0
    
    # Rank indicator
    Label:
        id: rank_indicator
        text: root.rank_letter
        pos_hint: {"x":0.2,"center_y":0.5}
        size_hint: (0.1, 1)
        font_size: root.font_ratio * FONTS_SIZES.title
        font_name: PATH_TITLE_FONT
        color: COLORS.black

        canvas.before:
            Color:
                rgba: root.rank_color
            RoundedRectangle:
                pos: self.pos
                size: self.size
                radius: [root.radius*root.font_ratio]
    
    # Level up image
    Image:
        id: level_up
        source: PATH_ICONS + "level_up.png"
        pos_hint: {"x":0.9,"center_y":0.5}
        size_hint: (0.1, 1)
        fit_mode: "contain"
        opacity: 1 if root.will_level_up else 0

<CharacterSkillsLayout>:

<MedalsCard>:

    # Background with title
    OlympeCard:
        header_mode: True
        header_text: root.title_card
        pos: (0, 0)
        size_hint: (CARD_WIDTH, 1)
        foldable_mode: True
        is_folded: root.is_folded
        line_width: root.line_width
        font_ratio: root.font_ratio

<CharacterInfoWithMainSportsLayout>:

    # Background with title
    OlympeCard:
        header_mode: True
        header_text: root.title_card
        header_height: root.header_height
        font_size: FONTS_SIZES.label
        image_mode: True
        has_icon_in_image: root.is_hurt
        image_source: root.image_source
        image_release_function: root.image_release_function
        money_mode: True
        money_amount: root.salary
        foldable_mode: root.foldable_mode
        is_folded: root.is_folded
        keep_line_folded: True
        pos: (0, 0)
        size_hint: (CARD_WIDTH, 1)
        line_width: root.line_width
        font_ratio: root.font_ratio

<SkillsCard>:

    # Background with title
    OlympeCard:
        header_mode: True
        header_text: root.title_card
        pos: (0, 0)
        size_hint: (CARD_WIDTH, 1)
        foldable_mode: True
        is_folded: root.is_folded
        line_width: root.line_width

<CompleteRecruitCard>:

    # Background with title
    OlympeCard:
        header_mode: True
        header_text: root.title_card
        pos: (0, 0)
        size_hint: (CARD_WIDTH, 1)
        foldable_mode: True
        is_folded: False
        line_width: root.line_width
        font_ratio: root.font_ratio

    ### Information ###
    
    CharacterButtonWithIcon:
        id: character
        image_source: root.image_source
        size_hint: (None, None)
        height: root.character_height*root.font_ratio
        width: self.height
        pos_hint: {"x": 0.05}
        y: root.font_ratio * (MARGIN_HEIGHT * 3 + len(root.skills_dict) * SKILL_HEIGHT + root.recruit_button_height)
        font_ratio: root.font_ratio
        line_width: root.line_width
        disable_button: True

    MoneyLayout:
        coins_count: root.salary
        salary_mode: True
        font_ratio: root.font_ratio
        size_hint: (None, None)
        height: root.character_height*root.font_ratio / 3 - 8*root.font_ratio
        width: root.width * (1 - 0.05*4) - character.width
        x: root.width * 0.05 * 2 + character.width
        y: root.font_ratio * (MARGIN_HEIGHT * 3 + len(root.skills_dict) * SKILL_HEIGHT + root.recruit_button_height + 2*root.character_height/3 + 6)

    SurroundedLabel:
        text: root.age
        font_ratio: root.font_ratio
        size_hint: (None, None)
        height: root.character_height*root.font_ratio / 3 - 8*root.font_ratio
        width: root.width * (1 - 0.05*4) - character.width
        x: root.width * 0.05 * 2 + character.width
        y: root.font_ratio * (MARGIN_HEIGHT * 3 + len(root.skills_dict) * SKILL_HEIGHT + root.recruit_button_height + root.character_height/3 + 4)

    SurroundedLabel:
        text: root.reputation
        font_ratio: root.font_ratio
        size_hint: (None, None)
        height: root.character_height*root.font_ratio / 3 - 8*root.font_ratio
        width: root.width * (1 - 0.05*4) - character.width
        x: root.width * 0.05 * 2 + character.width
        y: root.font_ratio * (MARGIN_HEIGHT * 3 + len(root.skills_dict) * SKILL_HEIGHT + root.recruit_button_height + 2)

    # Recruit button
    TextMoneyLayoutPressedButton:
        coins_amount: root.recruit_price
        size_hint: (0.5, None)
        height: root.recruit_button_height*root.font_ratio
        font_ratio: root.font_ratio
        y: MARGIN_HEIGHT*root.font_ratio
        pos_hint: {"center_x": 0.5}
        release_function: root.recruit_release_function
        disable_button: root.disable_button

<CompleteInscriptionCard>:

    # Background with title
    OlympeCard:
        header_mode: True
        header_text: root.title_card
        pos: (0, 0)
        size_hint: (CARD_WIDTH, 1)
        foldable_mode: True
        is_folded: False
        line_width: root.line_width
        font_ratio: root.font_ratio

    ### Information ###
    
    CharacterButtonWithIcon:
        id: character
        image_source: root.image_source
        size_hint: (None, None)
        height: root.character_height*root.font_ratio
        width: self.height
        pos_hint: {"x": 0.05}
        icon_mode: root.best_medal_source != ""
        icon_source: root.best_medal_source
        icon_position: {"right": 0.975, "y": 0.025}
        y: root.font_ratio * (MARGIN_HEIGHT * 3 + len(root.skills_dict) * SKILL_HEIGHT + root.button_height)
        font_ratio: root.font_ratio
        line_width: root.line_width
        disable_button: True

    SurroundedLabel:
        text: root.health
        font_ratio: root.font_ratio
        size_hint: (None, None)
        height: root.character_height*root.font_ratio / 3 - 8*root.font_ratio
        width: root.width * (1 - 0.05*4) - character.width
        x: root.width * 0.05 * 2 + character.width
        y: root.font_ratio * (MARGIN_HEIGHT * 3 + len(root.skills_dict) * SKILL_HEIGHT + root.button_height + 2*root.character_height/3 + 6)

    SurroundedLabel:
        text: root.fatigue_evolution
        font_ratio: root.font_ratio
        size_hint: (None, None)
        height: root.character_height*root.font_ratio / 3 - 8*root.font_ratio
        width: root.width * (1 - 0.05*4) - character.width
        x: root.width * 0.05 * 2 + character.width
        y: root.font_ratio * (MARGIN_HEIGHT * 3 + len(root.skills_dict) * SKILL_HEIGHT + root.button_height + root.character_height/3 + 4)

    SurroundedLabel:
        text: root.wound_risk
        font_ratio: root.font_ratio
        size_hint: (None, None)
        height: root.character_height*root.font_ratio / 3 - 8*root.font_ratio
        width: root.width * (1 - 0.05*4) - character.width
        x: root.width * 0.05 * 2 + character.width
        y: root.font_ratio * (MARGIN_HEIGHT * 3 + len(root.skills_dict) * SKILL_HEIGHT + root.button_height + 2)

    # Send button
    PressedButton:
        text: root.button_text
        size_hint: (0.5, None)
        height: root.button_height*root.font_ratio
        font_ratio: root.font_ratio
        y: MARGIN_HEIGHT*root.font_ratio
        pos_hint: {"center_x": 0.5}
        release_function: root.release_function
        disable_button: root.disable_button
        background_color: root.button_color
        pressed_color: root.button_pressed_color

<SmallInscriptionCard>:

    # Background with title
    OlympeCard:
        header_mode: True
        header_text: root.title_card
        header_height: root.height
        font_size: FONTS_SIZES.label
        image_mode: True
        has_icon_in_image: root.best_medal_source != ""
        icon_in_image_source: root.best_medal_source
        icon_in_image_position: {"right": 0.975, "y": 0.025}
        image_source: root.image_source
        button_mode: True
        button_text: root.button_text
        button_disable_button: root.disable_button
        button_release_function: root.release_function
        button_color: root.button_color
        button_pressed_color: root.button_pressed_color
        foldable_mode: True
        is_folded: True
        pos: (0, 0)
        size_hint: (CARD_WIDTH, 1)
        line_width: root.line_width
        font_ratio: root.font_ratio

<PlanificationCard>:

    # Background with title
    OlympeCard:
        header_mode: True
        header_text: root.title_card
        foldable_mode: True
        is_folded: False
        pos: (0, 0)
        size_hint: (CARD_WIDTH, 1)
        line_width: root.line_width
        font_ratio: root.font_ratio

    CharacterButtonWithIcon:
        id: character
        image_source: root.image_source
        size_hint: (None, None)
        height: root.character_height*root.font_ratio
        width: self.height
        pos_hint: {"x": 0.05}
        icon_mode: root.is_hurt
        y: root.font_ratio * (MARGIN_HEIGHT * 2 + SKILL_HEIGHT)
        font_ratio: root.font_ratio
        line_width: root.line_width

    MoneyLayout:
        coins_count: root.total_price
        font_ratio: root.font_ratio
        size_hint: (None, None)
        pos_hint: {"x": 0.05}
        width: character.width
        height: root.font_ratio*SKILL_HEIGHT
        y: root.font_ratio * MARGIN_HEIGHT
        minus_mode: root.minus_mode
        plus_mode: not root.minus_mode

<SmallPlanificationCard>:

    # Background with title
    OlympeCard:
        header_mode: True
        header_text: root.title_card
        header_height: root.height
        font_size: FONTS_SIZES.label
        image_mode: True
        image_source: root.image_source
        has_icon_in_image: root.is_hurt
        icon_in_image_source: PATH_ICONS + "hurt.png"
        foldable_mode: True
        is_folded: True
        keep_line_folded: False
        money_mode: True
        money_amount: root.total_price
        money_minus_mode: root.minus_mode
        money_plus_mode: not root.minus_mode
        pos: (0, 0)
        size_hint: (CARD_WIDTH, 1)
        line_width: root.line_width
        font_ratio: root.font_ratio
