#:kivy 2.2.1

<CharacterButtonWithIcon>:
    # Background
    canvas.before:
        Color:
            rgba: self.background_color
        Rectangle:
            pos: (0, 0)
            size: self.size

    # Line
    canvas.after:
        Color:
            rgba: self.line_color
        Line:
            rectangle: (self.x, self.y, self.width, self.height)
            width: self.line_width * self.font_ratio

    # Character image
    Image:
        id: image
        source: root.image_source
        pos_hint: {"center_x": 0.5, "y": 0}
        size_hint: (None, 0.9)
        width: self.height

    # Icon
    Image:
        id: icon
        source: root.icon_source
        color: root.icon_color
        pos_hint: root.icon_position
        size_hint: (None, 0.3)
        width: self.height
        opacity: 1 if root.icon_mode else 0

<OlympeCard>:

    canvas.before:
        Color:
            rgba: self.background_color
        Rectangle:
            pos: (0, 0)
            size: self.size

        Color:
            rgba: COLORS.white if self.header_mode and (not self.is_folded or self.keep_line_folded) else COLORS.transparent
        Line:
            points: [self.line_offset_vertical*self.font_ratio, self.height - self.header_height*self.font_ratio, self.width - self.line_offset_vertical*self.font_ratio, self.height - self.font_ratio * self.header_height]
            width: LARGE_LINE_WIDTH*root.font_ratio

    CharacterButtonWithIcon:
        id: character_image
        image_source: root.image_source
        pos_hint: {"x": 0.025}
        size_hint: (None, None)
        height: 0.8*root.header_height
        y: root.height - root.header_height//2*root.font_ratio - self.height//2
        width: self.height
        opacity: 1 if root.image_mode else 0
        icon_mode: root.has_icon_in_image
        icon_source: root.icon_in_image_source
        icon_position: root.icon_in_image_position
        release_function: root.image_release_function
        font_ratio: root.font_ratio
        line_width: root.line_width

    Label:
        id: label
        text: root.header_text
        font_size: root.font_ratio * root.font_size
        font_name: root.text_font_name
        pos_hint: {"x": 0.025} if not root.image_mode else {"x": 0.025*2 + character_image.width/(root.width+1)}
        y: root.height - root.header_height//2*root.font_ratio - self.height//2
        shorten: False
        size_hint: (None, None)
        size: self.texture_size
        halign: "left"
        valign: "middle"
        color: root.font_color

    MoneyLayout:
        id: money_frame
        coins_count: root.money_amount
        font_ratio: root.font_ratio
        size_hint: (root.money_size_hint[0], None)
        height: root.money_size_hint[1]*root.header_height
        y: root.height - root.header_height//2*root.font_ratio - self.height//2
        pos_hint: {"right": 0.95 - icon.width/(root.width+1)} if root.icon_mode else {"right": 0.95}
        opacity: 1 if root.money_mode else 0
        line_width: root.line_width
        minus_mode: root.money_minus_mode
        plus_mode: root.money_plus_mode

    PressedButton:
        id: button
        text: root.button_text
        size_hint: (0.35, None)
        font_ratio: root.font_ratio
        height: 0.5*root.header_height
        y: root.height - root.header_height//2*root.font_ratio - self.height//2
        pos_hint: {"right": 0.95 - icon.width/(root.width+1)}
        disable_button: root.button_disable_button and root.button_mode
        release_function: root.button_release_function
        opacity: 1 if root.button_mode else 0
        background_color: root.button_color
        pressed_color: root.button_pressed_color

    IconPressedButton:
        id: icon
        icon_source: root.icon_source
        size_hint_y_icon: root.size_hint_y_icon
        size_hint: (None, None)
        height: HEADER_HEIGHT * 0.65
        width: self.height
        pos_hint: {"right": 0.975}
        y: root.height - root.header_height//2*root.font_ratio - self.height//2
        font_ratio: root.font_ratio
        release_function: root.icon_function
        opacity: 1 if root.icon_mode else 0
        radius: RADIUS_SMALL

    SurroundedLabel:
        text: root.left_label
        font_ratio: root.font_ratio
        size_hint: (0.4, None)
        height: root.header_height * 0.65
        pos_hint: {"x": 0.025}
        y: root.height - root.header_height//2*root.font_ratio - self.height//2
        line_width: root.line_width
        font_size: root.font_size
        text_font_name: root.text_font_name
        opacity: 1 if root.left_surrounded_label_mode else 0

<SportLabelButton>:

    SurroundedLabel:
        text: root.text
        font_ratio: root.font_ratio
        size_hint: (1, 0.7)
        pos_hint: {"center_x": 0.5, "center_y": 0.5}
        color: root.line_color
        line_width: root.line_width
        outline_mode: root.is_selected
        font_size: root.font_size
        text_font_name: root.text_font_name

<SmallRoomCard>:

    # Background with title
    OlympeCard:
        header_mode: True
        header_text: root.title_card
        header_height: root.height
        font_size: root.font_size
        foldable_mode: True
        is_folded: True
        keep_line_folded: False
        pos: (0, 0)
        size_hint: (1, 1)
        line_width: root.line_width
        font_ratio: root.font_ratio

<CompleteRoomCard>:

    # Background with title
    OlympeCard:
        header_mode: True
        header_text: root.title_card
        font_size: root.font_size
        foldable_mode: True
        is_folded: False
        pos: (0, 0)
        size_hint: (1, 1)
        line_width: root.line_width
        font_ratio: root.font_ratio

    FramedImage:
        id: image
        image_source: root.image_source
        pos_hint: {"x": 0.05}
        y: root.font_ratio*(2*MARGIN_HEIGHT+BIG_BUTTON_HEIGHT)
        size_hint: (0.35, None)
        height: ROOM_HEIGHT*root.font_ratio
        font_ratio: root.font_ratio
        fit_mode: "cover"

    TextMoneyLayoutUnderPressedButton:
        coins_amount: root.price
        text: root.button_text
        size_hint: (None, None)
        width: image.width
        height: BIG_BUTTON_HEIGHT*root.font_ratio
        y: MARGIN_HEIGHT*root.font_ratio
        pos_hint: {"x": 0.05}
        release_function: root.buy_function
